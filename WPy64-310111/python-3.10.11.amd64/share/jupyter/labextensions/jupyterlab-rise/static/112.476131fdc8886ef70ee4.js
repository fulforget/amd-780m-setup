"use strict";(self.webpackChunkjupyterlab_rise=self.webpackChunkjupyterlab_rise||[]).push([[112],{112:(e,t,n)=>{n.r(t),n.d(t,{IRisePreviewTracker:()=>w,default:()=>x});var o=n(866),i=n(510),a=n(886),l=n(767),s=n(598),r=n(442),c=n(918),d=n(591);const h=new d.LabIcon({name:"RISE",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16" fill="none" stroke="#4f4f4f">\n    <path d="M15 14.25l3 6m-9-6l-3 6m-4-16h20-2v10H4v-10z" class="jp-icon3" stroke-width="2" />\n    <path d="M9.6 11.6v-1.5m-1.5 1.5V6.1m-1.5 5.5V8.1m5.5 3.5h3m-3-1.5h6m-6-1.5h6m-6-2h5" class="jp-icon3"\n        stroke-width="1.2" />\n</svg>'}),u=new d.LabIcon({name:"RISE:fullScreen",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16" fill="#4f4f4f">\n    <path class="jp-icon3" d="M22 22v-6h-2v4h-4v2zM2 22h6v-2H4v-4H2zM22 2h-6v2h4v4h2zM2 2v6h2V4h4V2z" />\n</svg>'});var v=n(379),p=n(526),m=n(840),g=n(431);const w=new p.Token("jupyterlab-rise:IRisePreviewTracker");class f extends v.DocumentWidget{constructor(e){super({...e,content:new i.IFrame({sandbox:["allow-same-origin","allow-scripts","allow-downloads","allow-modals","allow-popups"]})}),this._ready=new p.PromiseDelegate,this._ready.reject("Not loading at instantiation.");const{getRiseUrl:t,context:n,renderOnSave:o,translator:a}=e;this.getRiseUrl=t,this._path=n.path;const l=(null!=a?a:r.nullTranslator).load("rise");this.content.title.icon=h,this._renderOnSave=null!=o&&o,n.pathChanged.connect((()=>{this.path=n.path}));const s=new i.ToolbarButton({icon:d.refreshIcon,tooltip:l.__("Reload Preview"),onClick:()=>{this.reload()}}),c=new b.CheckBox({checked:this._renderOnSave,onChange:e=>{var t,n;this._renderOnSave=null!==(n=null===(t=e.target)||void 0===t?void 0:t.checked)&&void 0!==n&&n},translator:a});this.toolbar.addItem("fullscreen",new i.ToolbarButton({icon:u,tooltip:l.__("Open the slideshow in full screen"),onClick:()=>{e.commands.execute("RISE:fullscreen-plugin")}})),n&&(this.toolbar.addItem("renderOnSave",c),n.ready.then((()=>{n.fileChanged.connect((()=>{this.renderOnSave&&this.reload()}))}))),this.toolbar.addItem("spacer",i.Toolbar.createSpacerItem()),this.toolbar.addItem("reload",s)}get ready(){return this._ready.promise}dispose(){this.isDisposed||(super.dispose(),m.Signal.clearData(this))}reload(){const e=this.content.node.querySelector("iframe");e.contentWindow&&e.contentWindow.location.reload()}get renderOnSave(){return this._renderOnSave}setActiveCellIndex(e,t=!0){const n=this.content.node.querySelector("iframe");if(t){this._ready=new p.PromiseDelegate;const t=()=>{n.contentWindow.removeEventListener("load",t);const e=setInterval((()=>{n.contentDocument.querySelector(".reveal")&&(clearInterval(e),this._ready.resolve())}),500)};this.content.url=this.getRiseUrl(this.path,e),n.contentWindow.addEventListener("load",t)}else n.contentWindow&&n.contentWindow.history.pushState(null,"",this.getRiseUrl(this.path,e))}get path(){return this._path}set path(e){e!==this._path&&(this._path=e,this.setActiveCellIndex(0))}}class y extends v.ABCWidgetFactory{constructor(e,t,n){super(n),this.getRiseUrl=e,this.commands=t,this.defaultRenderOnSave=!1}createNewWidget(e){return new f({context:e,commands:this.commands,getRiseUrl:this.getRiseUrl,renderOnSave:this.defaultRenderOnSave})}}var b,S;!function(e){class t extends g.Widget{constructor(e={}){var t,n,o;const i=(null!==(t=e.translator)&&void 0!==t?t:r.nullTranslator).load("rise"),a=document.createElement("label");a.insertAdjacentHTML("afterbegin",`<input name="renderOnSave" type="checkbox"></input>${i.__("Render on Save")}`),super({node:a}),this.input=a.childNodes.item(0),this.checked=null!==(n=e.checked)&&void 0!==n&&n,this.onChange=null!==(o=e.onChange)&&void 0!==o?o:()=>{}}get checked(){return this.input.checked}set checked(e){this.input.checked=e}onAfterAttach(e){super.onAfterAttach(e),this.input.addEventListener("change",this.onChange)}onBeforeDetach(e){this.input.removeEventListener("change",this.onChange),super.onBeforeDetach(e)}}e.CheckBox=t}(b||(b={})),function(e){e.openRise="RISE:slideshow",e.riseFullScreen="RISE:fullscreen-plugin",e.risePreview="RISE:preview",e.riseSetSlideType="RISE:set-slide-type"}(S||(S={}));const _={id:"jupyterlab-rise:plugin",autoStart:!0,requires:[r.ITranslator],optional:[l.INotebookTracker,i.ICommandPalette,o.ILayoutRestorer,s.ISettingRegistry],provides:w,activate:(e,t,n,o,l,s)=>{console.log("JupyterLab extension jupyterlab-rise is activated!");const r=new i.WidgetTracker({namespace:"rise"});if(!n)return r;const{commands:d,docRegistry:v,shell:p}=e,m=t.load("rise");let g=null;s&&s.load(_.id).then((e=>{g=e}));const w=new y(b,d,{name:"rise",fileTypes:["notebook"],modelName:"notebook"});function f(){return null!==(null==n?void 0:n.currentWidget)&&(null==n?void 0:n.currentWidget)===p.currentWidget}function b(e,t){let n=`${a.PageConfig.getBaseUrl()}rise/${e}`;return"number"==typeof t&&(n+=a.URLExt.objectToQueryString({activeCellIndex:t})),n}if(l&&l.restore(r,{command:"docmanager:open",args:e=>({path:e.context.path,factory:w.name}),name:e=>e.context.path,when:e.serviceManager.ready}),v.addWidgetFactory(w),w.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{r.save(t)})),r.add(t)})),d.addCommand(S.openRise,{label:e=>e.toolbar?"":m.__("Open as Reveal Slideshow"),caption:m.__("Open the current notebook in a new browser tab as an RevealJS slideshow."),execute:async()=>{const e=n.currentWidget;e&&(await e.context.save(),window.open(b(e.context.path,e.content.activeCellIndex)))},isEnabled:f}),d.addCommand(S.risePreview,{label:e=>e.toolbar?"":m.__("Render as Reveal Slideshow"),caption:m.__("Render the current notebook as Reveal Slideshow"),icon:h,execute:async e=>{const t=function(e){var t;const o=null!==(t=null==n?void 0:n.currentWidget)&&void 0!==t?t:null;return!1!==e.activate&&o&&p.activateById(o.id),o}(e);let o;if(t){o=t.context,await o.save();const n=await d.execute("docmanager:open",{path:o.path,factory:"rise",options:{mode:"split-right"}}),a=e=>{n.setActiveCellIndex(e.activeCellIndex,!1)};n.setActiveCellIndex(t.content.activeCellIndex),t.content.activeCellChanged.connect(a),n.disposed.connect((()=>{t.content.activeCellChanged.disconnect(a)})),!0===e.fullscreen&&n.ready.then((()=>{(0,i.showDialog)({title:m.__("Switch to full screen"),body:m.__("The slideshow is set to automatically open in full screen. Your web browser requires your confirmation to do so.")}).then((e=>{e.button.accept&&d.execute(S.riseFullScreen,{id:n.id})}))})).catch((e=>{console.log(e)}))}},isEnabled:f}),d.addCommand(S.riseFullScreen,{label:m.__("Full screen slideshow"),caption:m.__("Toggle full screen the current active slideshow"),icon:u,execute:async t=>{var n,o,i;t.id&&e.shell.activateById(t.id);const a=t.id?(0,c.toArray)(e.shell.widgets("main")).find((e=>e.id===t.id)):e.shell.currentWidget;if(a&&r.has(a)){const e=a.content.node.querySelector("iframe");if(e)if(document.fullscreenElement||(null===(n=e.contentDocument)||void 0===n?void 0:n.fullscreenElement))document.exitFullscreen&&await document.exitFullscreen();else{const t=()=>{var t,n;null===(n=null===(t=null==e?void 0:e.contentWindow)||void 0===t?void 0:t.document.querySelector("div.reveal"))||void 0===n||n.requestFullscreen()};"complete"===(null===(o=e.contentDocument)||void 0===o?void 0:o.readyState)?t():null===(i=e.contentWindow)||void 0===i||i.addEventListener("load",t)}}},isEnabled:()=>!!e.shell.currentWidget&&r.has(e.shell.currentWidget)}),d.addCommand(S.riseSetSlideType,{label:e=>m.__("Toggle slideshow %1 type",e.type),caption:e=>m.__("(Un)set active cell as a %1 cell",e.type),execute:t=>{var o,i;const a=t.type,l=e.shell.currentWidget;if(l&&n.has(l)){const e=null===(o=l.content.activeCell)||void 0===o?void 0:o.model;if(e){const t=null!==(i=e.metadata.get("slideshow"))&&void 0!==i?i:{};if(a!==t.slide_type){const n={...t};a?n.slide_type=a:delete n.slide_type,Object.keys(n).length>0?e.metadata.set("slideshow",n):e.metadata.delete("slideshow")}}}},isToggled:t=>{var o,i;const a=t.type,l=e.shell.currentWidget;if(l&&n.has(l)){const e=null===(o=l.content.activeCell)||void 0===o?void 0:o.model;if(e)return(null!==(i=e.metadata.get("slideshow"))&&void 0!==i?i:{}).slide_type===a&&!!a}return!1},isEnabled:e=>{var t;return["slide","subslide","fragment","skip","notes"].includes(null!==(t=e.type)&&void 0!==t?t:"")}}),n.widgetAdded.connect((async(t,n)=>{var o,a,l;if(n.toolbar.insertBefore("kernelName","RISE-button",new i.CommandToolbarButton({commands:d,id:S.risePreview,args:{toolbar:!0}})),"Rise"!==e.name){await n.context.ready;let e=null!==(l=(null!==(a=null===(o=n.content.model)||void 0===o?void 0:o.metadata.get("rise"))&&void 0!==a?a:{}).autolaunch)&&void 0!==l&&l;g&&(e|=g.get("autolaunch").composite),e&&await d.execute(S.risePreview,{fullscreen:!0})}})),o){const e="Notebook Operations";[S.openRise,S.risePreview].forEach((t=>{o.addItem({command:t,category:e})}))}return r}},x=_}}]);